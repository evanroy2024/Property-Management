{% extends 'outbase.html' %}
{% load static %}

{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600&display=swap');

*{
    box-sizing:border-box;
    font-family:'Roboto',sans-serif!important;
}

body{
    background:#f8f9fb;
    color:#111827;
}

/* PAGE */
.page-wrap{
    width:100%;
    padding:24px 32px;
}

/* TITLE */
.page-title{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    font-size:30px;
    font-weight:500;
    margin-bottom:12px;
}

.page-title img{
    width:52px;
}

/* SUBTITLE */
.page-subtitle{
    text-align:center;
    color:#6b7280;
    font-size:15px;
    margin-bottom:26px;
    max-width:700px;
    margin-left:auto;
    margin-right:auto;
}

/* NAVIGATION TABS */
.nav-tabs{
    display:flex;
    justify-content:center;
    gap:14px;
    margin-bottom:26px;
    flex-wrap:wrap;
}

.nav-tab{
    padding:12px 24px;
    border-radius:10px;
    font-size:15px;
    font-weight:500;
    text-decoration:none;
    transition:all 0.2s ease;
}

.nav-tab.all{
    background:#2563eb;
    color:#fff;
}

.nav-tab.all:hover{
    background:#1d4ed8;
}

.nav-tab.open{
    background:#f59e0b;
    color:#000;
}

.nav-tab.open:hover{
    background:#d97706;
}

.nav-tab.completed{
    background:#10b981;
    color:#fff;
}

.nav-tab.completed:hover{
    background:#059669;
}

.nav-tab.denied{
    background:#ef4444;
    color:#fff;
}

.nav-tab.denied:hover{
    background:#dc2626;
}

/* CARD */
.card{
    background:#fff;
    border-radius:14px;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
    padding:18px 18px 8px;
}

/* FILTER BAR */
.filters{
    display:flex;
    gap:14px;
    margin-bottom:18px;
    flex-wrap:wrap;
}

.filter-select{
    flex:1;
    min-width:260px;
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:10px;
    padding:14px 16px;
    font-size:15px;
    font-weight:400;
    color:#111;
}

/* TABLE */
.table-wrap{
    width:100%;
    overflow-x:auto;
}

.table{
    width:100%;
    border-collapse:collapse;
    min-width:1000px;
}

.table thead th{
    padding:16px 14px;
    font-size:15px;
    font-weight:600;
    border-bottom:1px solid #e5e7eb;
    text-align:left;
    text-transform:uppercase;
    letter-spacing:.4px;
}

.table tbody td{
    padding:18px 14px;
    font-size:15px;
    font-weight:400;
    border-bottom:1px solid #f1f1f1;
    vertical-align:top;
}

.table tbody tr:hover{
    background:#fafafa;
}

/* ACTION LINKS */
.view-link{
    color:#2563eb;
    font-weight:500;
    text-decoration:none;
}

.view-link:hover{
    text-decoration:underline;
}

/* APPROVAL BUTTONS */
.approval-actions{
    display:flex;
    gap:8px;
}

.btn-approve,
.btn-deny{
    padding:8px 16px;
    border-radius:8px;
    font-size:14px;
    font-weight:500;
    text-decoration:none;
    transition:all 0.2s ease;
    display:inline-block;
    border:1px solid;
}

.btn-approve{
    background:#fff;
    color:#10b981;
    border-color:#10b981;
}

.btn-approve:hover{
    background:#10b981;
    color:#fff;
}

.btn-approve.disabled{
    background:#10b981;
    color:#fff;
    opacity:0.6;
    cursor:not-allowed;
}

.btn-deny{
    background:#fff;
    color:#ef4444;
    border-color:#ef4444;
}

.btn-deny:hover{
    background:#ef4444;
    color:#fff;
}

.btn-deny.disabled{
    background:#ef4444;
    color:#fff;
    opacity:0.6;
    cursor:not-allowed;
}

/* EMPTY */
.empty{
    text-align:center;
    padding:26px;
    font-weight:500;
}

/* MOBILE */
@media(max-width:768px){
    .page-wrap{
        padding:20px;
    }
    .page-title{
        font-size:22px;
    }
    .page-subtitle{
        font-size:14px;
    }
    .nav-tabs{
        gap:10px;
    }
    .nav-tab{
        padding:10px 18px;
        font-size:14px;
    }
}
</style>

<div class="page-wrap">

    <!-- TITLE -->
    <div class="page-title">
        <img src="{% static 'img/smalllogo.png' %}" alt="">
        Walk-Thru Open Reports
    </div>

    <!-- SUBTITLE -->
    <div class="page-subtitle">
        All your Service Request Open Items are here. Go through them and if you have any questions, kindly get back to us.
    </div>

    <!-- NAVIGATION TABS -->
  

    <!-- CARD -->
    <div class="card">

        <!-- FILTERS -->
        <form method="get" class="filters">

            <!-- PROPERTY FILTER -->
            <select name="property" class="filter-select" onchange="this.form.submit()">
                <option value="">All Properties</option>
                {% for p in properties %}
                    <option value="{{ p.id }}"
                        {% if request.GET.property == p.id|stringformat:"s" %}selected{% endif %}>
                        {{ p.address }}
                    </option>
                {% endfor %}
            </select>

            <!-- MONTH FILTER -->
            <select name="month" class="filter-select" onchange="this.form.submit()">
                <option value="">All Months</option>
                {% for m in months %}
                    <option value="{{ m|date:'Y-m' }}"
                        {% if request.GET.month == m|date:'Y-m' %}selected{% endif %}>
                        {{ m|date:"F Y" }}
                    </option>
                {% endfor %}
            </select>

        </form>

        <!-- TABLE -->
        <div class="table-wrap">
            <table class="table">
                <thead>
                    <tr>
                        <th>REPORT DATE</th>
                        <th>DESCRIPTION</th>
                        <th>TOTAL COST</th>
                        <th>ACTION</th>
                        <th>APPROVAL</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in reports %}
                    <tr>
                        <td>
                            {{ report.datetime|date:"M d, Y" }}<br>
                            {{ report.datetime|date:"h:i A" }}
                        </td>
                        <td>{{ report.description }}</td>
                        <td>${{ report.cost }}</td>
                        <td>
                            <a href="{% url 'mainapp:report_detail' report.pk %}" class="view-link">
                                View
                            </a>
                        </td>
                        <td>
                            <div class="approval-actions">
                                <a href="{% url 'mainapp:update_report_status' report.pk 'Pending' %}" 
                                   class="btn-approve {% if report.status == 'Completed' %}disabled{% endif %}">
                                    YES
                                </a>
                                <a href="{% url 'mainapp:update_report_status' report.pk 'Denied' %}"
                                   class="btn-deny {% if report.status == 'Denied' %}disabled{% endif %}">
                                    NO
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="empty">
                            No open reports found
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

{% endblock content %}
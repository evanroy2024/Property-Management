{% extends "outbase.html" %}
{% load static %}

{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600&display=swap');

*{
    box-sizing:border-box;
    font-family:'Roboto',sans-serif!important;
}

body{
    background:#f8f9fb;
    color:#111827;
}

/* PAGE */
.page-wrap{
    width:100%;
    padding:24px 32px;
}

/* TITLE */
.page-title{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    font-size:30px;
    font-weight:500;
    margin-bottom:12px;
}

.page-title img{
    width:52px;
}

.tagline{
    text-align:center;
    font-size:15px;
    color:#6b7280;
    margin-bottom:26px;
    max-width:800px;
    margin-left:auto;
    margin-right:auto;
}

/* CARD */
.card{
    background:#fff;
    border-radius:14px;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
    padding:18px 18px 8px;
    margin-bottom:24px;
}

/* FILTER BAR */
.filters{
    display:flex;
    gap:14px;
    margin-bottom:18px;
    flex-wrap:wrap;
}

.filter-select{
    flex:1;
    min-width:260px;
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:10px;
    padding:14px 16px;
    font-size:15px;
    font-weight:400;
    color:#111;
}

/* TABLE */
.table-wrap{
    width:100%;
    overflow-x:auto;
}

.table{
    width:100%;
    border-collapse:collapse;
    min-width:1000px;
}

.table thead th{
    padding:16px 14px;
    font-size:15px;
    font-weight:600;
    border-bottom:1px solid #e5e7eb;
    text-align:left;
    text-transform:uppercase;
    letter-spacing:.4px;
}

.table tbody td{
    padding:18px 14px;
    font-size:15px;
    font-weight:400;
    border-bottom:1px solid #f1f1f1;
    vertical-align:top;
}

.table tbody tr:hover{
    background:#fafafa;
}

.table tbody tr.active{
    background:#eff6ff;
}

/* ACTION */
.view-link{
    color:#2563eb;
    font-weight:500;
    text-decoration:none;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:6px;
}

.view-link:hover{
    text-decoration:underline;
}

.view-icon{
    width:16px;
    height:16px;
    display:inline-block;
}

/* EMPTY */
.empty{
    text-align:center;
    padding:26px;
    font-weight:500;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    padding-top: 60px;
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 25px;
    border-radius: 14px;
    width: 80%;
    max-width: 600px;
    box-shadow: 0 8px 24px rgba(0,0,0,.08);
    animation: slideIn 0.4s ease-out;
    position: relative;
}

@keyframes slideIn {
    from {
        transform: translateY(-30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.close-btn {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    position: absolute;
    right: 15px;
    top: 10px;
    cursor: pointer;
}

.close-btn:hover {
    color: #333;
}

.cancel-btn {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 15px;
    cursor: pointer;
    border-radius: 8px;
    transition: background-color 0.3s ease;
    font-weight:500;
}

.cancel-btn:hover {
    background-color: #d32f2f;
}

.modal-content h2 {
    font-size: 22px;
    color: #111827;
    margin-bottom: 15px;
    font-weight: 600;
}

#modalDetailsContent {
    font-size: 15px;
    color: #555;
    line-height: 1.6;
    margin-bottom: 20px;
}

#modalDetailsContent p{
    margin-bottom:10px;
}

/* MOBILE */
@media(max-width:768px){
    .page-wrap{
        padding:20px;
    }
    .page-title{
        font-size:22px;
    }
    .tagline{
        font-size:14px;
    }
}
</style>

<div class="page-wrap">

    <!-- TITLE -->
    <div class="page-title">
        <img src="{% static 'img/smalllogo.png' %}" alt="">
        Open Service Requests
    </div>
    
    <p class="tagline">All your Service Request Open Items are here go through them if you have any questions kindly get back to us</p>

    <!-- TABLE CARD -->
    <div class="card">
        
        <!-- FILTERS -->
        <form method="get" class="filters">

            <!-- MONTH FILTER -->
            <select name="month" class="filter-select" onchange="this.form.submit()">
                <option value="">All Months</option>
                {% for month in months %}
                    <option value="{{ month }}"
                        {% if request.GET.month == month %}selected{% endif %}>
                        {{ month }}
                    </option>
                {% endfor %}
            </select>

            <!-- SUBMISSION DATE FILTER -->
            <select name="date" class="filter-select" onchange="this.form.submit()">
                <option value="">All Submission Dates</option>
                {% for date in dates %}
                    <option value="{{ date }}"
                        {% if request.GET.date == date %}selected{% endif %}>
                        {{ date }}
                    </option>
                {% endfor %}
            </select>

        </form>
        
        <div class="table-wrap">
            <table class="table">
                <thead>
                    <tr>
                        <th>SUBMISSION DATE</th>
                        <th>SR TYPE</th>
                        <th>SR DESCRIPTION</th>
                        <th>APPROVAL STATUS</th>
                        <th>DETAILS</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in service_requests %}
                    <tr class="{% if request.status == 'open' %}active{% endif %}">
                        <td class="submission-date">{{ request.created_at|date:"M d, Y" }}<br>{{ request.created_at|date:"h:i A" }}</td>
                        <td class="sr-type">{{ request.request_type }}</td>
                        <td class="sr-description">{{ request.description }}</td>
                        <td class="sr-status">
                            {% if request.status == 'completed' %}
                                Completed
                            {% elif request.status == 'pending' %}
                                Pending
                            {% elif request.status == 'denied' %}
                                Denied
                            {% else %}
                                Open
                            {% endif %}
                        </td>
                        <td>
                            <a href="#" class="view-link" title="View" onclick="openModal(this); return false;">
                                <svg class="view-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <b>View</b>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="empty">No service requests found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- MODAL -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2>Request Details</h2>
            <div id="modalDetailsContent">
                <!-- Filled by JS -->
            </div>
            <button class="cancel-btn" onclick="closeModal()">Cancel</button>
        </div>
    </div>

</div>

<script>
    function openModal(button) {
        const row = button.closest("tr");

        const date = row.querySelector(".submission-date").innerText;
        const type = row.querySelector(".sr-type").innerText;
        const description = row.querySelector(".sr-description").innerText;
        const status = row.querySelector(".sr-status").innerText;

        const html = `
            <p><strong>Submission Date:</strong> ${date}</p>
            <p><strong>SR Type:</strong> ${type}</p>
            <p><strong>Description:</strong> ${description}</p>
            <p><strong>Status:</strong> ${status}</p>
        `;

        document.getElementById("modalDetailsContent").innerHTML = html;
        document.getElementById("detailsModal").style.display = "block";
    }

    function closeModal() {
        document.getElementById("detailsModal").style.display = "none";
    }

    window.onclick = function(event) {
        const modal = document.getElementById("detailsModal");
        if (event.target === modal) {
            closeModal();
        }
    }

    document.querySelectorAll('.table tbody tr').forEach(row => {
        row.addEventListener('click', () => {
            document.querySelectorAll('.table tbody tr').forEach(r => {
                r.classList.remove('active');
            });
            row.classList.add('active');
        });
    });
</script>

{% endblock content %}
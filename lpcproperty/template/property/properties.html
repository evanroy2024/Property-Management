{% extends 'outbase.html' %}
{% load static %}

{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
*{font-family:'Roboto',sans-serif!important}

body{background:#f4f6f8;color:#111}

/* WRAPPER */
.page-wrap{
    max-width:1100px;
    margin:30px auto;
    background:#fff;
    border-radius:14px;
    box-shadow:0 8px 22px rgba(0,0,0,.08);
    padding:34px;
}

/* HEADER */
.page-header{
    width:100%;
    margin-left:0;
    margin-right:0;
    margin-bottom:20px;
    padding-bottom: 25px;
    border-bottom:0.5px solid #d5d5d5;
    box-sizing:border-box;
}

@media (min-width:700px){
    .page-header{
        width:calc(100% + 68px);
        margin-left:-34px;
        margin-right:-34px;
    }
}

.page-header img{
    width:80px;
    margin-bottom:10px;
    margin-left: 3%;
}
.page-header h1{
    font-size:32px;
    font-family: 'Roboto', sans-serif !important;
    font-weight:500;
    color:#000000;
    display:inline-block;
    padding-bottom:8px;
    margin-left: 20px;
}

/* PROPERTY SELECT */
.property-select-wrap{
    margin-bottom:40px;
}
.property-select-wrap label{
    font-weight:700;
    display:block;
    margin-bottom:10px;
    color:#143049;
    font-size:15px;
}
.property-select{
    width:100%;
    padding:16px 18px;
    font-size:16px;
    border-radius:10px;
    border:1px solid #d0d7de;
    background:#fff;
    font-weight:600;
}

/* SECTIONS */
.section{margin-bottom:50px}
.section-title{
    font-size:21px;
    font-weight:800;
    color:#d1aa6b;
    border-bottom:1px solid #d1aa6b;
    padding-bottom:8px;
    margin-bottom:26px;
}

/* INFO GRID */
.info-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:22px;
}
.info-box span{
    display:block;
    font-size:13px;
    font-weight:700;
    color:#143049;
    margin-bottom:6px;
}
.info-value{
    font-size:16px;
    font-weight:500;
    color:#333;
}

/* CARDS */
.card{
    background:#fff;
    border-radius:12px;
    padding:24px;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
    margin-bottom:26px;
}

/* IMAGES */
.image-gallery{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:20px;
    flex-wrap:wrap;
}
.image-item{
    max-width:360px;
    text-align:center;
}
.gallery-img{
    width:100%;
    border-radius:14px;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,.18);
}

/* PRINT BUTTON */
.print-btn{
    margin-top:14px;
    padding:11px 20px;
    border:none;
    border-radius:10px;
    background:#4a90e2;
    color:#fff;
    font-weight:600;
    font-size:14px;
    cursor:pointer;
}

/* ROOMS */
.room-name{
    font-size:15px;
    margin-top:10px;
    font-weight:500;
}

/* FULLSCREEN IMAGE */
.full-screen-img{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.95);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
}
.full-screen-img img{
    max-width:95vw;
    max-height:95vh;
    border-radius:22px;
}

/* RESPONSIVE */
@media(max-width:768px){
    .page-wrap{padding:22px;margin:15px}
    .page-header h1{font-size:22px}
    .section-title{font-size:18px}
}
</style>

<div class="page-wrap">

    <div class="page-header">
        <img src="{% static 'img/smalllogo.png' %}">
        <h1>Property Information</h1>
        <button onclick="openEdit()" style="margin-left:45%;background:#2f5f9e;color:#fff;border:none;padding:10px 18px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.12);">Request Edits</button>

        <div></div>
    </div>

    {% if properties|length > 1 %}
    <div class="property-select-wrap">
        <label>Select Property</label>
        <form method="get">
            <select name="property" class="property-select" onchange="this.form.submit()">
                {% for p in properties %}
                <option value="{{ p.id }}" {% if property and p.id == property.id %}selected{% endif %}>
                    {{ p.address }}
                </option>
                {% endfor %}
            </select>
        </form>
    </div>
    {% endif %}

    <div class="section">
        <div class="section-title">Home Overview</div>
        {% if property %}
        <div class="info-grid">
            <div class="info-box"><span>Address</span><div class="info-value">{{ property.address }}</div></div>
            <div class="info-box"><span>Size</span><div class="info-value">{{ property.size_of_home }} SQ FT</div></div>
            <div class="info-box"><span>Stories</span><div class="info-value">{{ property.number_of_stories }}</div></div>
            <div class="info-box"><span>Construction</span><div class="info-value">{{ property.construction_type }}</div></div>
            <div class="info-box"><span>Year Built</span><div class="info-value">{{ property.year_built }}</div></div>
            <div class="info-box"><span>Pool</span><div class="info-value">{{ property.has_pool|yesno:"Yes,No" }}</div></div>
            <div class="info-box"><span>HOA</span><div class="info-value">{{ property.has_hoa|yesno:"Yes,No" }}</div></div>
        </div>
        {% endif %}
    </div>

    <div class="section">
  <div class="section-title">Contact Preference</div>

  <div class="info-grid">
    {% for contact in contacts %}
      <div class="info-box">
        <strong style="font-weight: 600;">
          {% if forloop.counter == 1 %}
            Primary Contact
          {% elif forloop.counter == 2 %}
            Secondary Contact
          {% elif forloop.counter == 3 %}
            Tertiary Contact
          {% else %}
            Contact {{ forloop.counter }}
          {% endif %}
        </strong>

        <div style="margin-top:6px;">
          <span style="font-size: 1rem;">{{ contact.name }}</span>
          <div class="info-value">
            {{ contact.email }}<br>
            {{ contact.phone }}<br>
            Preferred: {{ contact.preferred }}
          </div>
        </div>
      </div>
    {% empty %}
      <p>No contacts available.</p>
    {% endfor %}
  </div>
</div>


    <div class="section">
        <div class="section-title">Property Image</div>
        {% if property.property_pic %}
        <div class="image-gallery">
            <div class="image-item">
                <img src="{{ property.property_pic.url }}" class="gallery-img">
            </div>
        </div>
        {% else %}
        <p>No image available.</p>
        {% endif %}
    </div>

    <div class="section">
        <div class="section-title">Floor Plans</div>
        {% for floor in property.floors.all %}
        <div class="card">
            <strong style="font-size:19px;font-weight:700">{{ floor.floor_name }}</strong>

            {% if floor.floor_imgae %}
            <div class="image-gallery" style="margin-top:18px">
                <div class="image-item">
                    <img src="{{ floor.floor_imgae.url }}" class="gallery-img">
                    <button class="print-btn" onclick="printImage('{{ floor.floor_imgae.url }}')">
                        Print Floor Plan
                    </button>
                </div>
            </div>
            {% endif %}

            {% for room in floor.rooms.all %}
            <div class="room-name">â€¢ {{ room.room_name }}</div>
            {% endfor %}
        </div>
        {% empty %}
        <p>No floor plans available.</p>
        {% endfor %}
    </div>

    {% if client_manager %}
    <div class="section">
        <div class="section-title">Client Manager</div>
        <div class="info-grid">
            <div class="info-box"><span>Name</span><div class="info-value">{{ client_manager.first_name }} {{ client_manager.last_name }}</div></div>
            <div class="info-box"><span>Email</span><div class="info-value">{{ client_manager.email }}</div></div>
            <div class="info-box"><span>Phone</span><div class="info-value">{{ client_manager.phone_number }}</div></div>
            <!-- <div class="info-box"><span>Location</span><div class="info-value">{{ client_manager.city }}, {{ client_manager.state }}</div></div> -->
        </div>
    </div>
    {% endif %}

</div>

<script>
function printImage(url){
    const w=window.open("");
    w.document.write('<img src="'+url+'" style="max-width:100%">');
    w.document.close();
    w.focus();
    setTimeout(()=>{w.print();w.close();},400);
}
document.querySelectorAll('.gallery-img').forEach(img=>{
    img.onclick=()=>{
        const d=document.createElement('div');
        d.className='full-screen-img';
        d.innerHTML=`<img src="${img.src}">`;
        d.onclick=()=>d.remove();
        document.body.appendChild(d);
    }
});
</script>


<div id="editModal" style="display:none;position:fixed;inset:0;background:rgba(20,30,40,.6);z-index:9999;align-items:center;justify-content:center;">
  <form method="post" style="background:#fff;padding:26px;border-radius:14px;width:92%;max-width:460px;box-shadow:0 20px 45px rgba(0,0,0,.25);">
    {% csrf_token %}
    <h3 style="margin-bottom:6px;font-size:20px;font-weight:700;color:#143049;">Request Edits</h3>
    <p style="font-size:15px;margin-bottom:14px;color:#666;">
      Subject: <strong style="color:#d1aa6b;font-size:16px;">Property / Client Requested Edit</strong>
    </p>
    <textarea name="edit_message" required placeholder="Describe the changes you need..." style="width:100%;height:130px;padding:14px;border-radius:10px;border:1px solid #d0d7de;font-size:14px;resize:none;outline:none;"></textarea>
    <div style="margin-top:18px;display:flex;justify-content:flex-end;gap:10px;">
      <button type="button" onclick="closeEdit()" style="padding:10px 18px;border-radius:8px;border:1px solid #d0d7de;background:#f4f6f8;font-weight:600;cursor:pointer;">Cancel</button>
      <button type="submit" style="padding:10px 18px;border-radius:8px;border:none;background:#d1aa6b;color:#fff;font-weight:700;cursor:pointer;">Send</button>
    </div>
  </form>
</div>


<script>
function openEdit(){
  document.getElementById("editModal").style.display="flex";
}
function closeEdit(){
  document.getElementById("editModal").style.display="none";
}
</script>

{% endblock content %}
